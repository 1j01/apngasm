CMAKE_MINIMUM_REQUIRED(VERSION 2.8)

PROJECT(APNGASM)
SET(VERSION_MAJOR 3)
SET(VERSION_MINOR 0)
SET(VERSION_PATCH 0)
SET(VERSION "${VERSION_MAJOR}.${VERSION_MINOR}.${VERSION_PATCH}")

INCLUDE_DIRECTORIES(${APNGASM_SOURCE_DIR}/src)

# Generate version header
FILE(WRITE ${APNGASM_SOURCE_DIR}/src/apngasm-version.h 
	"#ifndef _VERSION_H_\n"
	"#define _VERSION_H_\n\n"
	"#define APNGASM_VERSION \"${VERSION}\"\n\n"
	"#endif"
)

ADD_SUBDIRECTORY(${APNGASM_SOURCE_DIR}/lib)
ADD_SUBDIRECTORY(${APNGASM_SOURCE_DIR}/bin)

##CPack definitions for package creation
INCLUDE(InstallRequiredSystemLibraries)

SET(CPACK_PACKAGE_VERSION_MAJOR "${VERSION_MAJOR}")
SET(CPACK_PACKAGE_VERSION_MINOR "${VERSION_MINOR}")
SET(CPACK_PACKAGE_VERSION_PATCH "${VERSION_PATCH}")
SET(CPACK_PACKAGE_DESCRIPTION_SUMMARY "apngasm APNG assembler libraries and command line tool")
SET(CPACK_PACKAGE_DESCRIPTION_FILE "${CMAKE_CURRENT_SOURCE_DIR}/DESCRIPTION.txt")
SET(CPACK_PACKAGE_LICENSE_FILE "${CMAKE_CURRENT_SOURCE_DIR}/LICENSE.txt")
SET(CPACK_PACKAGE_CONTACT "zero@genshin.org")
SET(CPACK_PACKAGE_FILE_NAME "apngasm_${VERSION}")
SET(CPACK_COMPONENTS_ALL libraries headers applications)

IF(UNIX)
	SET(CPACK_GENERATOR "DEB")
	SET(CPACK_DEBIAN_PACKAGE_DEPENDS "libc6 (>= 2.14), libpng12-0 (>= 1.2.13-4), zlib1g (>= 1:1.1.4)")
ENDIF(UNIX)
IF(APPLE)
	SET(CPACK_GENERATOR "PackageMaker")
ENDIF(APPLE)
IF(WIN32)
	SET(CPACK_GENERATOR "NSIS")
ENDIF(WIN32)

INCLUDE(CPack)

