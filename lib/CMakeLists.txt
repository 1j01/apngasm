CMAKE_MINIMUM_REQUIRED(VERSION 2.8)

PROJECT(APNGASM_LIB)

# Generate version header
SET(APNGASM_LIB_VERSION_MAJOR 3)
SET(APNGASM_LIB_VERSION_MINOR 0)
SET(APNGASM_LIB_VERSION_PATCH 0)
SET(APNGASM_LIB_VERSION "${APNGASM_LIB_VERSION_MAJOR}.${APNGASM_LIB_VERSION_MINOR}.${APNGASM_LIB_VERSION_PATCH}")

CONFIGURE_FILE(${PROJECT_SOURCE_DIR}/src/apngasm-version.h.in ${PROJECT_BINARY_DIR}/src/apngasm-version.h @ONLY)
INCLUDE_DIRECTORIES(${PROJECT_BINARY_DIR}/src)

# shared library and sources
ADD_LIBRARY(apngasm SHARED
  ${PROJECT_SOURCE_DIR}/src/apngasm.cpp
  ${PROJECT_SOURCE_DIR}/src/apngframe.cpp
  ${PROJECT_SOURCE_DIR}/src/spec/specreader.cpp
  ${PROJECT_SOURCE_DIR}/src/spec/specwriter.cpp
  ${PROJECT_SOURCE_DIR}/src/spec/priv/specreaderimpl.cpp
  ${PROJECT_SOURCE_DIR}/src/spec/priv/specwriterimpl.cpp
  ${PROJECT_SOURCE_DIR}/src/listener/apngasmlistener.cpp
)

FIND_PACKAGE(PNG REQUIRED)
INCLUDE_DIRECTORIES(${PNG_INCLUDE_DIR})
TARGET_LINK_LIBRARIES(apngasm ${PNG_LIBRARY})

#find_package(ZLIB_REQUIRED)
INCLUDE_DIRECTORIES(${ZLIB_INCLUDE_DIRS})
TARGET_LINK_LIBRARIES(apngasm ${ZLIB_LIBRARIES})

FIND_PACKAGE(Boost REQUIRED COMPONENTS regex filesystem system) 
INCLUDE_DIRECTORIES(${Boost_INCLUDE_DIRS})
TARGET_LINK_LIBRARIES(apngasm ${Boost_LIBRARIES})

INSTALL(TARGETS apngasm
	LIBRARY DESTINATION lib
	COMPONENT libraries)

INSTALL(FILES ${PROJECT_SOURCE_DIR}/src/apngasm.h ${PROJECT_SOURCE_DIR}/src/apngframe.h ${PROJECT_BINARY_DIR}/src/apngasm-version.h
	DESTINATION include
	COMPONENT headers)

##CPack definitions for package creation
INCLUDE(InstallRequiredSystemLibraries)

SET(CPACK_PACKAGE_VERSION_MAJOR "${APNGASM_LIB_VERSION_MAJOR}")
SET(CPACK_PACKAGE_VERSION_MINOR "${APNGASM_LIB_VERSION_MINOR}")
SET(CPACK_PACKAGE_VERSION_PATCH "${APNGASM_LIB_VERSION_PATCH}")
SET(CPACK_PACKAGE_DESCRIPTION_SUMMARY "apngasm APNG assembler libraries")
SET(CPACK_PACKAGE_DESCRIPTION_FILE "${PROJECT_SOURCE_DIR}/DESCRIPTION.txt")
SET(CPACK_PACKAGE_LICENSE_FILE "${PROJECT_SOURCE_DIR}/LICENSE.txt")
SET(CPACK_PACKAGE_CONTACT "zero@genshin.org")
SET(CPACK_PACKAGE_FILE_NAME "libapngasm_${APNGASM_LIB_VERSION}")
SET(CPACK_COMPONENTS libraries headers)

IF(UNIX)
	SET(CPACK_GENERATOR "DEB")
	SET(CPACK_DEBIAN_PACKAGE_DEPENDS "libc6 (>= 2.14), libpng12-0 (>= 1.2.13-4), zlib1g (>= 1:1.1.4)")
ENDIF(UNIX)
IF(APPLE)
	SET(CPACK_GENERATOR "PackageMaker")
ENDIF(APPLE)
IF(WIN32)
	SET(CPACK_GENERATOR "NSIS")
ENDIF(WIN32)

INCLUDE(CPack)
